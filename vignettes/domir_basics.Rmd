---
title: "Basic Concepts of Relative Importance Analysis"
subtitle: "Dominance Analysis with `{domir}`"
author: Joseph Luchman
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{domir_basics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Conceptual Introduction

## Dominance Analysis

The focus of the `{domir}` package is currently on the dominance analysis (DA) methodology for determining the relative importance of independent variables (IVs)/predictors/features in a predictive model. DA determines the relative importance of independent variables in an predictive model based on each IV's contribution to an overall model fit statistic.  More specifically, DA produces several results that decompose and compare the contribution each IV makes to the fit statistic to one another.  Conceptually, DA is an extension of Shapley value decomposition from Cooperative Game Theory (see GrÃ¶mping, 2007 for a discussion) which seeks to find solutions of how to subdivide "payoffs" (i.e., the fit statistic) to "players" (i.e., the IVs) based on their relative contribution to the payoff; the payoff is usually assumed to be a single value (i.e., scalar valued).

The implementation DA uses to estimate the Shapley value decomposition works by using a pre-selected predictive model and applying a very extensive experimental design to it.  Effectively, DA asks treats the predictive model as data and the IVs as factors in an experiment with a within-subjects full-factorial design (i.e., all possible combinations of the IVs are applied to the data).  Another way of describing the process is as a brute force method where all combinations of the IVs included or excluded is estimated from the data and the fit statistics associated with each sub-model is collected.

Assuming there are $p$ IVs in the pre-selected model, obtaining all possible combinations of the IVs results in $2^p$ models and fit statistics to be estimated. Again, each combination of $p$ variables alternating between included versus excluded (see Budescu, 1993).

## Key Caveat

As is mentioned above, an implication of the DA method is that the predictive model used in it is "pre-selected".  Hence, the model has been passed through model selection procedures and the user is confident that the model used in the dominance analysis is a good reflection of the "payoff" structure.  DA, at least the implementation of DA that acts like a full-factorial experiment, is not effective for model selection of IVs/finding IVs with trivial effects and removing them.

"Relative importance" as a concept is used in many different ways in statistics and data science and many of them refer to methods that are focused on, or are probably best used for, model selection/identifying trivial IVs for removal.  DA is a method that is more focused on importance in a "model evaluation" sense.  I see this as being an application where the user describes/interprets IVs' effects in the context of a finalized, predictive approach.  

## DA Impelemtation with `domin`

The `domin` function of the `{domir}` package implements the DA, full-factorial methodology with a flexible R function application programming interface/API.  The API is based on the R formula which is used in many predictive R modeling functions in base and recommended packages such as `lm`, `glm`, `arima`, `polr`, '`nnet`, `lme`, and `gam`.  Functions that do not use formulas, or use variants of the standard R formula (i.e., the `Formula` package), can be accommodated using wrapper functions.

I see the DA methodology is a general approach to model evaluation using relative importance and it is this perspective that has guided the development of this package.  In my view, if you have a pre-selected predictive model and a fit statistic that can be applied to it, the `domin` can help you evaluate/interpret the contribution of the IVs in that model.

The vignette sections to come in this transition from a conceptual introduction to a more in-depth discussion of the DA methodology as implemented by `domin`.  

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Extensive Introductory Example

The example below focuses on a simpler predictive model but discusses conceptual elements of DA more extensively and some specifics in terms of `domin`'s implementation.

## Linear Regression-based DA

The example below uses the _mtcars_ datain the `{datasets}` package. Assume I have pre-selected, through whatever means, the following linear model:

`lm(mpg ~ am + cyl + carb, data = mtcars)`

Applying a DA to this model using `domin`, assuming the fit statistic of interest is the explained variance $R^2$, would look like:

```{r setup_intro}
library(domir)
library(datasets)

domin(mpg ~ am + cyl + carb, 
      lm, 
      list(summary, "r.squared"), 
      data = mtcars)
```

`domin` produces results in four sections including fit statistics overall, as well as general and conditional dominance statistics, and complete dominance designations. Below each is discussed in turn.

### Fit Statistics

```
#> Overall Fit Statistic:      0.8113023 
```

This results section reports on the value of the fit statistic of the pre-selected model.  Other fit statistic value adjustments are reported in this section but are the focus of other vignette sections below.

The $R^2$ for this model is ~$.81$ meaning the model explains around 80% of the variance in _mpg_; this is the limiting value for how much each IV will be able to explain.  The three IVs in this model will be ascribed separate components of this $.81$.

### General Dominance Statistics
```
#> General Dominance Statistics:
#>      General Dominance Standardized Ranks
#> am           0.2156848    0.2658501     2
#> cyl          0.4173094    0.5143698     1
#> carb         0.1783081    0.2197801     3
```

This section reports on how the fit statistic value from the last section is divided up among the IVs.  The statistics produced when dividing up the overall fit statistic associated with the pre-selected model are known as *general dominance statistics*.  Because they sum to the overall fit statistic, general dominance statistics are considered the results from the DA that are easiest to interpret.

General dominance statistics are computed as a weighted average of the marginal/incremental contribution to prediction (as measured by the focal fit metric, in this case the $R^2$) the IV makes across all sub-models in which it is included. For example, _am_ has a value of ~$0.2157$ which means, on average, _am_ results in an increment to the $R^2$ of about twenty-two percentage points when it is included in the model versus when it is not.  

The *Standardized* column of statistics expresses the general dominance statistic value as a percentage of the overall fit statistic value.  _am_'s contributions to prediction comprise 27% of the predictive usefulness of the pre-selected model.

Finally, the general dominance statistics can be compared to one another to determine which variables "generally dominate" others. Here, _cyl_'s larger general dominance statistic than _am_ indicates that it "generally dominates", and is thus more important than, _am_. These *general dominance designations* are reflected in the *Ranks* column reported.  The only time a general dominance designation cannot be made between two IVs is when they are exactly equal to one another in terms of predicting the dependent variable (DV)/outcome/response. 

General dominance statistics for an IV are also the arithmetic average of that IV's conditional dominance statistics discussed next.

### Conditional Dominance Statistics

```
#> Conditional Dominance Statistics:
#>         IVs: 1    IVs: 2     IVs: 3
#> am   0.3597989 0.2164938 0.07076149
#> cyl  0.7261800 0.4181185 0.10762967
#> carb 0.3035184 0.1791172 0.05228872
```

This section reports on how the predictive usefulness for any given IV changes as more IVs are added to the model.  These statistics describing change as more IVs are added to the model are known as *conditional dominance statistics*.

Conditional dominance statistics are computed as the average incremental contribution to prediction an IV makes within a single "order" of models--where "order" refers to a distinct number of independent variables in the prediction model. As such, each IV will have $p$ different conditional dominance statistics.

In the example above, order one is `IVs: 1` and refers to the incremental contribution the IV makes to predicting the DV when by itself.  Order two is `IVs: 2` and refers to the average incremental contribution the IV makes in predicting the DV when another IV is included in the model.  Finally, order three is `IVs: 3` and refers to the incremental contribution the IV makes beyond the other two IVs.  

Conditional dominance statistics provide more information about each IV than general dominance statistics as they reveal the effect that IV redundancy has on prediction for each IV.  In the above conditional dominance statistic matrix, _am_ is slightly less affected by variable redundancy overall as its average incremental contribution to fit shrinks relatively less than the other two IVs across all three orders.

As with general dominance statistics, conditional dominance statistics can be compared to determine which "conditionally dominate" others.  Conditional dominance is determined for an IV over another when its conditional dominance statistics are larger than another the other IV's statistics within-orders for all `p` orders. If, at any order, the conditional dominance statistics for two IVs are equal or there is a change rank order between IVs, no conditional dominance designation can be made between those IVs. As applied to the results above, _am_ is conditionally dominated by _cyl_ as its conditional dominance statistics are smaller than _cyl_'s at order 1, 2, and 3.

Because it is more difficult to achieve, conditional dominance is a stronger importance criterion than general dominance.  Additionally, conditional dominance implies general dominance--but the reverse is not true. An IV can generally, but not conditionally, dominate another IV.

The next section discusses the strongest of the dominance designations.

### Complete Dominance Designations

```
#> Complete Dominance Designations:
#>              Dmnated?am Dmnated?cyl Dmnated?carb
#> Dmnates?am           NA       FALSE         TRUE
#> Dmnates?cyl        TRUE          NA         TRUE
#> Dmnates?carb      FALSE       FALSE           NA
```

This section reports on how the predictive usefulness for an IV compares with another IV across all models that are comparable for the two IVs.  The comparisons described in this section do not form statistics but only dominance designations; these are known as *complete dominance designations*.

Complete dominance designations are made by comparing all possible incremental contributions to predicting the DV between two IVs for models that are comparable--which include all sub-models that do not include the other IV. For example, the comparison between _am_ and _cyl_ would include comparing the model with _am_ alone to the model with _cyl_ alone as well as the model with _am_ and _carb_ beyond the model with _carb_ to the model with _cyl_ and _carb_ beyond the model with _carb_.

Complete dominance is the most difficult dominance criterion to satisfy as it requires that an IV *always* have a larger increment to to prediction across all, $2^{p-2}$ comparable individual models between two IVs. 

By comparison to general and conditional dominance designations, the complete dominance designation has no statistic.  The matrix `domin` returns is a set of logicals that reads from the left to right. A value of `TRUE` means that the IV in the row completely dominates the IV in the column. Conversely, a value of `FALSE`  means the opposite, that the IV in the row is completely dominated by the IV in the column. A `NA` value means no complete dominance designation could be made as the comparison IVs' incremental contributions differ in relative magnitude from model to model.

In the example above, the complete dominance designations show a clear hierarchy among the IVs with `cyl` completely dominating `am` which completely dominates `carb`.  Complete dominance implies both general and conditional dominance, but, again, the reverse is not true. An IV can conditionally, but not completely, dominate another IV.

## How Dominance Statistics Work

In this section, I expand more on what goes on during a DA and how statistics are computed using an example.

In the example below, I create a custom function that exports model results to an external R object (i.e., the `results` data frame) that 

The programming that is involved in the function below is a little complex (how it works and how to develop something like it will be the subject of another vignette!) but the idea is that it captures the formula `domin` feeds into the `lm` model and collects the $R^2$ value the model produces.

```{r capture_r2s}
lm_capture <- 
  function(x, ...) {
    count <<- count + 1
    y <- lm(x, ...)
    results[count, "fmla"] <<- deparse(x)
    results[count, "r2"] <<- summary(y)[["r.squared"]]
    return(y)
  }

count <- 0
results <- data.frame(fmla = rep("", times = 2^3-1), 
                      r2 = rep(NA, times = 2^3-1) )

lm_da <- domin(mpg ~ am + cyl + carb, lm_capture, list(summary, "r.squared"), data = mtcars)

results
```



<!-- # Brief Introductory Examples -->

<!-- The examples below focuses expand to discuss more complex predictive models and Stata code  -->
<!-- but somewhat less regarding conceptual implications. -->

<!-- ## Ordered Logistic Regression-based DA -->

<!-- A model like `ologit` is easy to accommodate in `domin` like below. -->

<!-- ``` -->
<!-- . domin rep78 trunk weight length, reg(ologit) fitstat(e(r2_p)) all(turn) -->

<!-- Total of 7 regressions -->

<!-- General dominance statistics: Ordered logistic regression -->
<!-- Number of obs             =                      69 -->
<!-- Overall Fit Statistic     =                  0.1209 -->
<!-- All Subsets Fit Stat.     =                  0.1003 -->

<!--             |      Dominance      Standardized      Ranking -->
<!--  rep78      |      Stat.          Domin. Stat. -->
<!-- ------------+------------------------------------------------------------------------ -->
<!--  trunk      |         0.0082      0.0680            2  -->
<!--  weight     |         0.0021      0.0174            3  -->
<!--  length     |         0.0102      0.0845            1  -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Conditional dominance statistics -->
<!-- ------------------------------------------------------------------------------------- -->

<!--          #indepvars:  #indepvars:  #indepvars: -->
<!--                   1            2            3 -->
<!--  trunk       0.0131       0.0077       0.0039 -->
<!-- weight       0.0027       0.0016       0.0020 -->
<!-- length       0.0139       0.0097       0.0070 -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Complete dominance designation -->
<!-- ------------------------------------------------------------------------------------- -->

<!--                     dominated?:  dominated?:  dominated?: -->
<!--                          trunk       weight       length -->
<!--  dominates?:trunk            0            1           -1 -->
<!-- dominates?:weight           -1            0           -1 -->
<!-- dominates?:length            1            1            0 -->
<!-- ------------------------------------------------------------------------------------- -->

<!-- Strongest dominance designations -->

<!-- length completely dominates trunk -->
<!-- trunk completely dominates weight -->
<!-- length completely dominates weight -->

<!-- Variables included in all subsets: turn -->
<!-- ``` -->

<!-- As compared to the `regress`-based DA reported in the first example, this example includes a  -->
<!-- covariate that is controlled for across all model subsets.  -->

<!-- The `All Subsets Fit Stat.     =                  0.1003` result represents the amount  -->
<!-- of the McFadden pseudo-R-square that is associated with the variable in all subsets  -->
<!-- (i.e., in `all()`).  -->

<!-- Note that the dominance statistics reported are now residualized and reflect the removal of  -->
<!-- the all fitstats fit statistic.  -->
<!-- Variables included in all subsets are also reported at the end of the results display  -->
<!-- (e.g., `Variables included in all subsets: turn`). -->

<!-- ## Logistic Regression-based DA -->

<!-- `logit` is another command that can be accommodated in `domin`.  In this example, _rep78_ is  -->
<!-- used as a factor variable. -->

<!-- ``` -->
<!-- . domin foreign trunk weight, reg(logit) fitstat(e(r2_p)) sets((i.rep78)) -->

<!-- Total of 7 regressions -->

<!-- General dominance statistics: Logistic regression -->
<!-- Number of obs             =                      59 -->
<!-- Overall Fit Statistic     =                  0.5229 -->

<!--             |      Dominance      Standardized      Ranking -->
<!--  foreign    |      Stat.          Domin. Stat. -->
<!-- ------------+------------------------------------------------------------------------ -->
<!--  trunk      |         0.0834      0.1595            3  -->
<!--  weight     |         0.2611      0.4994            1  -->
<!--  set1       |         0.1783      0.3411            2  -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Conditional dominance statistics -->
<!-- ------------------------------------------------------------------------------------- -->

<!--          #indepvars:  #indepvars:  #indepvars: -->
<!--                   1            2            3 -->
<!--  trunk       0.2002       0.0495       0.0005 -->
<!-- weight       0.4154       0.2272       0.1407 -->
<!--   set1       0.2855       0.1444       0.1051 -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Complete dominance designation -->
<!-- ------------------------------------------------------------------------------------- -->

<!--                     dominated?:  dominated?:  dominated?: -->
<!--                          trunk       weight         set1 -->
<!--  dominates?:trunk            0           -1           -1 -->
<!-- dominates?:weight            1            0            1 -->
<!--   dominates?:set1            1           -1            0 -->
<!-- ------------------------------------------------------------------------------------- -->

<!-- Strongest dominance designations -->

<!-- weight completely dominates trunk -->
<!-- set1 completely dominates trunk -->
<!-- weight completely dominates set1 -->

<!-- Variables in set1: i.rep78 -->
<!-- ``` -->

<!-- The `sets()` option incorporates independent variables as inseparable sets that are considered  -->
<!-- *an* independent variable in the DA.  -->
<!-- The label for each set is denoted sequentially as they are included (e.g., _set1_).  -->
<!-- In addition, variables in sets are included near the end of the output  -->
<!-- (i.e., `Variables in set1: i.rep78`).  -->

<!-- # Intermediate Examples -->

<!-- These examples outline more complex applications of DA to Stata models. -->

<!-- ## Linear Regression-based DA with Non-additive and Non-linear Effects -->

<!-- The example below outlines a process in which two quadratic effects and a product are  -->
<!-- residualized and used as independent variables in a linear regression-based DA to determine  -->
<!-- their importance. -->

<!-- The process involves residualizing the squared and product terms and using them, as is, in the -->
<!-- DA. -->

<!-- ``` -->
<!-- .     generate mpg2 = mpg^2 -->

<!-- .  -->
<!-- .     generate headr2 = headroom^2 -->

<!-- .  -->
<!-- .     generate mpg_headr = mpg*headroom -->

<!-- .  -->
<!-- .     regress mpg2 mpg -->

<!--       Source |       SS           df       MS      Number of obs   =        74 -->
<!-- -------------+----------------------------------   F(1, 72)        =   2425.89 -->
<!--        Model |  5640570.83         1  5640570.83   Prob > F        =    0.0000 -->
<!--     Residual |  167411.003        72  2325.15282   R-squared       =    0.9712 -->
<!-- -------------+----------------------------------   Adj R-squared   =    0.9708 -->
<!--        Total |  5807981.84        73   79561.395   Root MSE        =     48.22 -->

<!-- ------------------------------------------------------------------------------ -->
<!--         mpg2 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval] -->
<!-- -------------+---------------------------------------------------------------- -->
<!--          mpg |   48.04619   .9754908    49.25   0.000     46.10159     49.9908 -->
<!--        _cons |  -536.6594   21.51824   -24.94   0.000    -579.5552   -493.7636 -->
<!-- ------------------------------------------------------------------------------ -->

<!-- .  -->
<!-- .     predict mpg2r, resid -->

<!-- .  -->
<!-- .     regress headr2 headroom -->

<!--       Source |       SS           df       MS      Number of obs   =        74 -->
<!-- -------------+----------------------------------   F(1, 72)        =   3197.55 -->
<!--        Model |  1947.18924         1  1947.18924   Prob > F        =    0.0000 -->
<!--     Residual |  43.8453928        72  .608963789   R-squared       =    0.9780 -->
<!-- -------------+----------------------------------   Adj R-squared   =    0.9777 -->
<!--        Total |  1991.03463        73   27.274447   Root MSE        =    .78036 -->

<!-- ------------------------------------------------------------------------------ -->
<!--       headr2 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval] -->
<!-- -------------+---------------------------------------------------------------- -->
<!--     headroom |    6.10485   .1079609    56.55   0.000     5.889633    6.320066 -->
<!--        _cons |  -8.607759   .3356446   -25.65   0.000    -9.276855   -7.938664 -->
<!-- ------------------------------------------------------------------------------ -->

<!-- .  -->
<!-- .     predict headr2r, resid -->

<!-- .  -->
<!-- .     regress mpg_headr mpg headroom -->

<!--       Source |       SS           df       MS      Number of obs   =        74 -->
<!-- -------------+----------------------------------   F(2, 71)        =   1102.79 -->
<!--        Model |  24303.2769         2  12151.6384   Prob > F        =    0.0000 -->
<!--     Residual |  782.348117        71  11.0189876   R-squared       =    0.9688 -->
<!-- -------------+----------------------------------   Adj R-squared   =    0.9679 -->
<!--        Total |   25085.625        73  343.638699   Root MSE        =    3.3195 -->

<!-- ------------------------------------------------------------------------------ -->
<!--    mpg_headr |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval] -->
<!-- -------------+---------------------------------------------------------------- -->
<!--          mpg |   2.837136   .0737653    38.46   0.000     2.690052     2.98422 -->
<!--     headroom |   20.40514   .5044586    40.45   0.000     19.39927      21.411 -->
<!--        _cons |  -59.75086   2.619192   -22.81   0.000    -64.97338   -54.52834 -->
<!-- ------------------------------------------------------------------------------ -->

<!-- .  -->
<!-- .     predict mpg_headrr, resid -->

<!-- .  -->
<!-- .     domin price mpg headroom mpg2r headr2r mpg_headrr -->
<!-- Regression type not entered in reg().  -->
<!-- reg(regress) assumed. -->

<!-- Fitstat type not entered in fitstat().  -->
<!-- fitstat(e(r2)) assumed. -->


<!-- Total of 31 regressions -->

<!-- Progress in running all regression subsets -->
<!-- 0%------50%------100% -->
<!-- .................... -->
<!-- General dominance statistics: Linear regression -->
<!-- Number of obs             =                      74 -->
<!-- Overall Fit Statistic     =                  0.3948 -->

<!--             |      Dominance      Standardized      Ranking -->
<!--  price      |      Stat.          Domin. Stat. -->
<!-- ------------+------------------------------------------------------------------------ -->
<!--  mpg        |         0.2274      0.5761            1  -->
<!--  headroom   |         0.0142      0.0361            4  -->
<!--  mpg2r      |         0.1044      0.2644            2  -->
<!--  headr2r    |         0.0388      0.0984            3  -->
<!--  mpg_headrr |         0.0099      0.0251            5  -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Conditional dominance statistics -->
<!-- ------------------------------------------------------------------------------------- -->

<!--              #indepvars:  #indepvars:  #indepvars:  #indepvars:  #indepvars: -->
<!--                       1            2            3            4            5 -->
<!--        mpg       0.2196       0.2191       0.2236       0.2323       0.2425 -->
<!--   headroom       0.0131       0.0091       0.0101       0.0156       0.0233 -->
<!--      mpg2r       0.1203       0.1104       0.1029       0.0973       0.0910 -->
<!--    headr2r       0.0429       0.0435       0.0419       0.0376       0.0282 -->
<!-- mpg_headrr       0.0072       0.0109       0.0124       0.0118       0.0072 -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Complete dominance designation -->
<!-- ------------------------------------------------------------------------------------- -->

<!--                         dominated?:  dominated?:  dominated?:  dominated?:  dominated?: -->
<!--                                mpg     headroom        mpg2r      headr2r   mpg_headrr -->
<!--        dominates?:mpg            0            1            1            1            1 -->
<!--   dominates?:headroom           -1            0           -1           -1            0 -->
<!--      dominates?:mpg2r           -1            1            0            1            1 -->
<!--    dominates?:headr2r           -1            1           -1            0            1 -->
<!-- dominates?:mpg_headrr           -1            0           -1           -1            0 -->
<!-- ------------------------------------------------------------------------------------- -->

<!-- Strongest dominance designations -->

<!-- mpg completely dominates headroom -->
<!-- mpg2r completely dominates headroom -->
<!-- headr2r completely dominates headroom -->
<!-- mpg completely dominates mpg2r -->
<!-- mpg completely dominates headr2r -->
<!-- mpg2r completely dominates headr2r -->
<!-- mpg completely dominates mpg_headrr -->
<!-- mpg2r completely dominates mpg_headrr -->
<!-- headr2r completely dominates mpg_headrr -->
<!-- headroom generally dominates mpg_headrr -->
<!-- ``` -->

<!-- In this case, the squared term for _mpg_ (i.e., _mpg2r_) was actually more important than most  -->
<!-- other terms in the model.  -->
<!-- This approach is based on the article by LeBreton, Tonidandel, and Krasikova (2013). -->

<!-- ## Linear Regression-based Relative Weights Analysis with Bootstrapped Standard Errors -->

<!-- `domin` can also estimate relative weights analysis (RWA) using the `epsilon` option.  -->
<!-- RWA is a faster, approximation to DA and obviates the each subset regression by orthogonalizing  -->
<!-- independent variables using singular value decomposition (see `matrix svd`).  -->

<!-- `epsilon`'s singular value decomposition approach is not equivalent to the all  -->
<!-- possible combinations ensemble approach of DA but is many fold faster for models with many  -->
<!-- independent variables and tends to produce similar answers regarding relative importance.  -->

<!-- DA and RWA can also be `boostrap`-ped to obtain stadard errors and evaluate statistic  -->
<!-- sampling stability if desired. -->

<!-- ``` -->
<!-- .     bootstrap, reps(500): domin price mpg headroom trunk turn gear_ratio foreign length weight, epsilon -->
<!-- (running domin on estimation sample) -->

<!-- Bootstrap replications (500) -->
<!-- ----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5  -->
<!-- ..................................................    50 -->
<!-- ..................................................   100 -->
<!-- ..................................................   150 -->
<!-- ..................................................   200 -->
<!-- ..................................................   250 -->
<!-- ..................................................   300 -->
<!-- ..................................................   350 -->
<!-- ..................................................   400 -->
<!-- ..................................................   450 -->
<!-- ..................................................   500 -->

<!-- General dominance statistics: Custom user analysis -->
<!-- Number of obs             =                      74 -->
<!-- Overall Fit Statistic     =                  0.5806 -->

<!--             |      Dominance      Standardized      Ranking -->
<!--  price      |      Stat.          Domin. Stat. -->
<!-- ------------+------------------------------------------------------------------------ -->
<!--  mpg        |         0.0803      0.1382            4  -->
<!--  headroom   |         0.0148      0.0255            8  -->
<!--  trunk      |         0.0349      0.0601            7  -->
<!--  turn       |         0.0533      0.0918            6  -->
<!--  gear_ratio |         0.0619      0.1067            5  -->
<!--  foreign    |         0.0910      0.1567            2  -->
<!--  length     |         0.0824      0.1420            3  -->
<!--  weight     |         0.1620      0.2791            1  -->
<!-- ------------------------------------------------------------------------------------- -->

<!-- .  -->
<!-- .     estat bootstrap -->

<!-- Dominance analysis                              Number of obs     =         74 -->
<!--                                                 Replications      =        500 -->

<!-- ------------------------------------------------------------------------------ -->
<!--              |    Observed               Bootstrap -->
<!--        price |       Coef.       Bias    Std. Err.  [95% Conf. Interval] -->
<!-- -------------+---------------------------------------------------------------- -->
<!--          mpg |   .08025451   .0056983   .02608266    .0428729   .1343196  (BC) -->
<!--     headroom |   .01480511    .005788   .00994976    .0045644   .0253761  (BC) -->
<!--        trunk |   .03488086   .0052553   .01569048    .0146097   .0700839  (BC) -->
<!--         turn |   .05328024   .0088603   .01346109    .0228937   .0711584  (BC) -->
<!--   gear_ratio |   .06193881   .0102595   .02574597    .0342715   .1201322  (BC) -->
<!--      foreign |   .09099184   .0039005   .03310621    .0428155   .1721853  (BC) -->
<!--       length |   .08242763   .0060164   .01522731    .0471752   .1077507  (BC) -->
<!--       weight |   .16203422   .0023967   .03416152    .0966866   .2320645  (BC) -->
<!-- ------------------------------------------------------------------------------ -->
<!-- (BC)   bias-corrected confidence interval -->
<!-- ``` -->

<!-- Note that other Stata post-estimation commands such as `test` can be used to evaluate differences  -->
<!-- between these statistics. -->

<!-- ## Multivariate Linear Regression-based DA -->

<!-- `domin` comes packaged with a sub-wrapper program `mvdom` that allows for estimating DA  -->
<!-- statistics with multiple dependent variables. -->

<!-- The model reflected in the `mvdom`-based DA below is: -->

<!-- `mvreg price gear_ratio foreign length weight = mpg headroom trunk turn` -->

<!-- ``` -->
<!-- . domin price mpg headroom trunk turn, reg(mvdom, dvs(gear_ratio foreign length weight)) fitstat(e(r2)) -->

<!-- Total of 15 regressions -->

<!-- General dominance statistics: Multivariate regression -->
<!-- Number of obs             =                      74 -->
<!-- Overall Fit Statistic     =                  0.8659 -->

<!--             |      Dominance      Standardized      Ranking -->
<!--  price      |      Stat.          Domin. Stat. -->
<!-- ------------+------------------------------------------------------------------------ -->
<!--  mpg        |         0.2605      0.3008            2  -->
<!--  headroom   |         0.0794      0.0917            4  -->
<!--  trunk      |         0.1779      0.2055            3  -->
<!--  turn       |         0.3482      0.4020            1  -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Conditional dominance statistics -->
<!-- ------------------------------------------------------------------------------------- -->

<!--            #indepvars:  #indepvars:  #indepvars:  #indepvars: -->
<!--                     1            2            3            4 -->
<!--      mpg       0.6798       0.2314       0.0987       0.0319 -->
<!-- headroom       0.2923       0.0191       0.0052       0.0009 -->
<!--    trunk       0.5379       0.1251       0.0339       0.0148 -->
<!--     turn       0.7887       0.3239       0.1782       0.1018 -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Complete dominance designation -->
<!-- ------------------------------------------------------------------------------------- -->

<!--                       dominated?:  dominated?:  dominated?:  dominated?: -->
<!--                              mpg     headroom        trunk         turn -->
<!--      dominates?:mpg            0            1            1           -1 -->
<!-- dominates?:headroom           -1            0           -1           -1 -->
<!--    dominates?:trunk           -1            1            0           -1 -->
<!--     dominates?:turn            1            1            1            0 -->
<!-- ------------------------------------------------------------------------------------- -->

<!-- Strongest dominance designations -->

<!-- turn completely dominates mpg -->
<!-- mpg completely dominates headroom -->
<!-- trunk completely dominates headroom -->
<!-- turn completely dominates headroom -->
<!-- mpg completely dominates trunk -->
<!-- turn completely dominates trunk -->
<!-- ``` -->

<!-- The dominance statistics above account for multiple dependent variables and are based on the  -->
<!-- approach described by Azen and Budescu (2006). -->

<!-- ## Gamma regression-based DA -->

<!-- `domin` allows for any scalar valued fit statistic to br used as a DA-able statistic and  -->
<!-- thus statistics such as model deviance can be used. -->

<!-- The example below uses a `glm` model with a gamma distribution. -->

<!-- ``` -->
<!-- . domin price mpg rep78 headroom, reg(glm, family(gamma) link(power -1)) fitstat(e(deviance)) consmodel reverse -->

<!-- Total of 7 regressions -->

<!-- General dominance statistics: Generalized linear models -->
<!-- Number of obs             =                      69 -->
<!-- Overall Fit Statistic     =                  7.4580 -->
<!-- Constant-only Fit Stat.   =                 11.6141 -->

<!--             |      Dominance      Standardized      Ranking -->
<!--  price      |      Stat.          Domin. Stat. -->
<!-- ------------+------------------------------------------------------------------------ -->
<!--  mpg        |        -3.7935      0.9127            1  -->
<!--  rep78      |        -0.2118      0.0510            2  -->
<!--  headroom   |        -0.1509      0.0363            3  -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Conditional dominance statistics -->
<!-- ------------------------------------------------------------------------------------- -->

<!--            #indepvars:  #indepvars:  #indepvars: -->
<!--                     1            2            3 -->
<!--      mpg      -3.6135      -3.8087      -3.9583 -->
<!--    rep78      -0.0007      -0.2270      -0.4077 -->
<!-- headroom      -0.1876      -0.1661      -0.0989 -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Complete dominance designation -->
<!-- ------------------------------------------------------------------------------------- -->

<!--                       dominated?:  dominated?:  dominated?: -->
<!--                              mpg        rep78     headroom -->
<!--      dominates?:mpg            0            1            1 -->
<!--    dominates?:rep78           -1            0            0 -->
<!-- dominates?:headroom           -1            0            0 -->
<!-- ------------------------------------------------------------------------------------- -->

<!-- Strongest dominance designations -->

<!-- mpg completely dominates rep78 -->
<!-- mpg completely dominates headroom -->
<!-- rep78 generally dominates headroom -->
<!-- ``` -->

<!-- Important notes about this model is that a `consmodel` is estimated (e.g.,  -->
<!-- `Constant-only Fit Stat.   =                 11.6141`).  -->
<!-- Like entries in the `all()` model, this value is subtracted from the DA statistics.  -->

<!-- The `consmodel` differs from `all()` in that applies only to the estimation and removal of model  -->
<!-- _cons_-tants/intercepts; this is useful when the constant-only model is non-zero. -->
<!-- This DA also `reverse`s the interpretation of the fit statistics such that smaller values  -->
<!-- represent more important independent variables (i.e., larger negative values). -->

<!-- ## Linear Mixed-effects Regression-based DA -->

<!-- `domin` also comes packaged with a sub-wrapper program `mixdom` that allows for estimating  -->
<!-- DA statistics with linear mixed effects models. -->

<!-- There can only be two levels of clustering/nesting in the data.  The analysis below uses  -->
<!-- the within-cluster r-square and the underlying model would be represented by: -->

<!-- `mixed ln_wage tenure hours age collgrad || id:` -->

<!-- ``` -->
<!-- .     webuse nlswork, clear -->
<!-- (National Longitudinal Survey.  Young Women 14-26 years of age in 1968) -->

<!-- .  -->
<!-- .     domin ln_wage tenure hours age collgrad, reg(mixdom, id(id)) fitstat(e(r2_w)) sets((i.race)) -->

<!-- Total of 31 regressions -->

<!-- Progress in running all regression subsets -->
<!-- 0%------50%------100% -->
<!-- .................... -->
<!-- General dominance statistics: Mixed-effects ML regression -->
<!-- Number of obs             =                   28036 -->
<!-- Overall Fit Statistic     =                  0.2688 -->

<!--             |      Dominance      Standardized      Ranking -->
<!--  ln_wage    |      Stat.          Domin. Stat. -->
<!-- ------------+------------------------------------------------------------------------ -->
<!--  tenure     |         0.0958      0.3564            2  -->
<!--  hours      |         0.0031      0.0114            5  -->
<!--  age        |         0.0406      0.1510            3  -->
<!--  collgrad   |         0.1175      0.4371            1  -->
<!--  set1       |         0.0119      0.0441            4  -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Conditional dominance statistics -->
<!-- ------------------------------------------------------------------------------------- -->

<!--            #indepvars:  #indepvars:  #indepvars:  #indepvars:  #indepvars: -->
<!--                     1            2            3            4            5 -->
<!--   tenure       0.1389       0.1130       0.0916       0.0744       0.0611 -->
<!--    hours       0.0053       0.0040       0.0029       0.0020       0.0012 -->
<!--      age       0.0860       0.0590       0.0364       0.0180       0.0034 -->
<!-- collgrad       0.1461       0.1274       0.1132       0.1034       0.0975 -->
<!--     set1       0.0157       0.0135       0.0117       0.0100       0.0084 -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Complete dominance designation -->
<!-- ------------------------------------------------------------------------------------- -->

<!--                       dominated?:  dominated?:  dominated?:  dominated?:  dominated?: -->
<!--                           tenure        hours          age     collgrad         set1 -->
<!--   dominates?:tenure            0            1            1            0            1 -->
<!--    dominates?:hours           -1            0           -1           -1           -1 -->
<!--      dominates?:age           -1            1            0           -1            0 -->
<!-- dominates?:collgrad            0            1            1            0            1 -->
<!--     dominates?:set1           -1            1            0           -1            0 -->
<!-- ------------------------------------------------------------------------------------- -->

<!-- Strongest dominance designations -->

<!-- tenure completely dominates hours -->
<!-- age completely dominates hours -->
<!-- collgrad completely dominates hours -->
<!-- set1 completely dominates hours -->
<!-- tenure completely dominates age -->
<!-- collgrad completely dominates age -->
<!-- tenure completely dominates set1 -->
<!-- collgrad completely dominates set1 -->
<!-- collgrad conditionally dominates tenure -->
<!-- age generally dominates set1 -->

<!-- Variables in set1: i.race -->
<!-- ``` -->

<!-- # Advanced Examples -->

<!-- The examples here outline some of the most advanced features of `domin` -->

<!-- ## Multinomial Logistic Regression-based DA -->
<!-- ### Custom Program Generation using BIC as Fit Statistic -->

<!-- `domin` can be adapted to dominance analyze any user-generated model--so long as they adhere  -->
<!-- to a specific structure `domin` expects. -->

<!-- Specifically, the program must `ereturn scalar` or `return scalar` the fit statistic and the  -->
<!-- program's `syntax` must follow `syntax varlist if , [option]`.  -->

<!-- In the example below, a custom program _myprog_ is defined to obtain the Bayesian Information  -->
<!-- Criterion following a `mlogit` for DA purposes. -->

<!-- ``` -->
<!-- .     program define myprog, eclass -->
<!--   1.  -->
<!-- .     syntax varlist if , [option] -->
<!--   2.  -->
<!-- .     tempname estlist -->
<!--   3.  -->
<!-- .     mlogit `varlist' `if' -->
<!--   4.  -->
<!-- .     estat ic -->
<!--   5.  -->
<!-- .     matrix `estlist' = r(S) -->
<!--   6.  -->
<!-- .     ereturn scalar bic = `estlist'[1,6] -->
<!--   7.  -->
<!-- .     end -->

<!-- .  -->
<!-- .     domin race tenure hours age nev_mar, reg(myprog) fitstat(e(bic)) consmodel reverse -->

<!-- Total of 15 regressions -->

<!-- General dominance statistics: Multinomial logistic regression -->
<!-- Number of obs             =                   28022 -->
<!-- Overall Fit Statistic     =              36025.3867 -->
<!-- Constant-only Fit Stat.   =              36482.9057 -->

<!--             |      Dominance      Standardized      Ranking -->
<!--  race       |      Stat.          Domin. Stat. -->
<!-- ------------+------------------------------------------------------------------------ -->
<!--  tenure     |        13.2083     -0.0289            4  -->
<!--  hours      |       -84.8225      0.1854            2  -->
<!--  age        |         3.0220     -0.0066            3  -->
<!--  nev_mar    |      -388.9268      0.8501            1  -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Conditional dominance statistics -->
<!-- ------------------------------------------------------------------------------------- -->

<!--           #indepvars:  #indepvars:  #indepvars:  #indepvars: -->
<!--                    1            2            3            4 -->
<!--  tenure      15.4426      10.2512      12.7821      14.3572 -->
<!--   hours    -102.4587     -91.2406     -77.0439     -68.5468 -->
<!--     age       9.5965       2.0195       1.4031      -0.9312 -->
<!-- nev_mar    -399.0177    -395.1525    -384.8246    -376.7124 -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Complete dominance designation -->
<!-- ------------------------------------------------------------------------------------- -->

<!--                      dominated?:  dominated?:  dominated?:  dominated?: -->
<!--                          tenure        hours          age      nev_mar -->
<!--  dominates?:tenure            0           -1           -1           -1 -->
<!--   dominates?:hours            1            0            1           -1 -->
<!--     dominates?:age            1           -1            0           -1 -->
<!-- dominates?:nev_mar            1            1            1            0 -->
<!-- ------------------------------------------------------------------------------------- -->

<!-- Strongest dominance designations -->

<!-- hours completely dominates tenure -->
<!-- age completely dominates tenure -->
<!-- nev_mar completely dominates tenure -->
<!-- nev_mar completely dominates hours -->
<!-- hours completely dominates age -->
<!-- nev_mar completely dominates age -->
<!-- ``` -->

<!-- ## Logistic Regression-based DA: Revisited -->
<!-- ### Multiply Imputed Estimates -->

<!-- `domin` can also accommodate multiply imputed data by including the `mi` option with  -->
<!-- multiply imputed data.  -->
<!-- By default, all imputations are used but options can be passed to `mi estimate` using  -->
<!-- `domin`'s `miopts()` option. -->

<!-- `domin` has been tested on `mi set` data styles of `wide`, `long`, and `flong`. -->

<!-- ``` -->
<!-- .     webuse mheart1s20, clear -->
<!-- (Fictional heart attack data; bmi missing) -->

<!-- .  -->
<!-- .     domin attack smokes age bmi hsgrad female, reg(logit) fitstat(e(r2_p)) mi -->

<!-- Total of 31 regressions -->

<!-- Progress in running all regression subsets -->
<!-- 0%------50%------100% -->
<!-- .................... -->
<!-- General dominance statistics: Logistic regression -->
<!-- Number of obs             =                     154 -->
<!-- Overall Fit Statistic     =                  0.1056 -->

<!--             |      Dominance      Standardized      Ranking -->
<!--  attack     |      Stat.          Domin. Stat. -->
<!-- ------------+------------------------------------------------------------------------ -->
<!--  smokes     |         0.0553      0.5234            1  -->
<!--  age        |         0.0248      0.2354            3  -->
<!--  bmi        |         0.0250      0.2369            2  -->
<!--  hsgrad     |         0.0003      0.0028            4  -->
<!--  female     |         0.0002      0.0016            5  -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Conditional dominance statistics -->
<!-- ------------------------------------------------------------------------------------- -->

<!--          #indepvars:  #indepvars:  #indepvars:  #indepvars:  #indepvars: -->
<!--                   1            2            3            4            5 -->
<!-- smokes       0.0548       0.0549       0.0551       0.0554       0.0560 -->
<!--    age       0.0231       0.0238       0.0247       0.0257       0.0270 -->
<!--    bmi       0.0222       0.0235       0.0249       0.0264       0.0281 -->
<!-- hsgrad       0.0000       0.0001       0.0002       0.0004       0.0008 -->
<!-- female       0.0000       0.0001       0.0002       0.0002       0.0003 -->
<!-- ------------------------------------------------------------------------------------- -->
<!-- Complete dominance designation -->
<!-- ------------------------------------------------------------------------------------- -->

<!--                     dominated?:  dominated?:  dominated?:  dominated?:  dominated?: -->
<!--                         smokes          age          bmi       hsgrad       female -->
<!-- dominates?:smokes            0            1            1            1            1 -->
<!--    dominates?:age           -1            0            0            1            1 -->
<!--    dominates?:bmi           -1            0            0            1            1 -->
<!-- dominates?:hsgrad           -1           -1           -1            0            0 -->
<!-- dominates?:female           -1           -1           -1            0            0 -->
<!-- ------------------------------------------------------------------------------------- -->

<!-- Strongest dominance designations -->

<!-- smokes completely dominates age -->
<!-- smokes completely dominates bmi -->
<!-- smokes completely dominates hsgrad -->
<!-- age completely dominates hsgrad -->
<!-- bmi completely dominates hsgrad -->
<!-- smokes completely dominates female -->
<!-- age completely dominates female -->
<!-- bmi completely dominates female -->
<!-- bmi generally dominates age -->
<!-- hsgrad generally dominates female -->
<!-- ``` -->